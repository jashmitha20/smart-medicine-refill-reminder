{"ast":null,"code":"import apiService from './api.ts';\nimport { mockApi } from './mockApi.ts';\nclass AuthService {\n  async login(credentials) {\n    try {\n      const response = await apiService.post('/auth/signin', credentials);\n      // Store auth token and user data\n      apiService.setAuthToken(response.accessToken);\n      localStorage.setItem('user', JSON.stringify(response.user));\n      return response;\n    } catch (error) {\n      // Fallback to mock API if mock mode is enabled\n      if ((process.env.REACT_APP_USE_MOCK_API || '').toLowerCase() === 'true') {\n        const response = await mockApi.signin({\n          email: credentials.email,\n          password: credentials.password\n        });\n        apiService.setAuthToken(response.accessToken);\n        localStorage.setItem('user', JSON.stringify(response.user));\n        return response;\n      }\n      throw error;\n    }\n  }\n  async signup(userData) {\n    const response = await apiService.post('/auth/signup', userData);\n\n    // Store auth token and user data\n    apiService.setAuthToken(response.accessToken);\n    localStorage.setItem('user', JSON.stringify(response.user));\n    return response;\n  }\n  async logout() {\n    try {\n      await apiService.post('/auth/logout');\n    } catch (error) {\n      // Even if logout request fails, clear local storage\n      console.warn('Logout request failed, but clearing local storage');\n    } finally {\n      apiService.removeAuthToken();\n    }\n  }\n  async getCurrentUser() {\n    return await apiService.get('/auth/me');\n  }\n  getCurrentUserFromStorage() {\n    const userStr = localStorage.getItem('user');\n    if (userStr) {\n      try {\n        return JSON.parse(userStr);\n      } catch (error) {\n        console.error('Error parsing user from localStorage:', error);\n        localStorage.removeItem('user');\n      }\n    }\n    return null;\n  }\n  isAuthenticated() {\n    return apiService.isAuthenticated() && !!this.getCurrentUserFromStorage();\n  }\n  clearAuth() {\n    apiService.removeAuthToken();\n  }\n}\nexport default new AuthService();","map":{"version":3,"names":["apiService","mockApi","AuthService","login","credentials","response","post","setAuthToken","accessToken","localStorage","setItem","JSON","stringify","user","error","process","env","REACT_APP_USE_MOCK_API","toLowerCase","signin","email","password","signup","userData","logout","console","warn","removeAuthToken","getCurrentUser","get","getCurrentUserFromStorage","userStr","getItem","parse","removeItem","isAuthenticated","clearAuth"],"sources":["C:/Users/Lenovo/smart-medicine-refill-system/frontend/src/services/authService.ts"],"sourcesContent":["import apiService from './api.ts';\r\nimport { AuthResponse, LoginRequest, SignUpRequest, User } from '../types/index.ts';\r\nimport { mockApi } from './mockApi.ts';\r\n\r\nclass AuthService {\r\n  async login(credentials: LoginRequest): Promise<AuthResponse> {\r\n    try {\r\n      const response = await apiService.post<AuthResponse>('/auth/signin', credentials);\r\n      // Store auth token and user data\r\n      apiService.setAuthToken(response.accessToken);\r\n      localStorage.setItem('user', JSON.stringify(response.user));\r\n      return response;\r\n    } catch (error) {\r\n      // Fallback to mock API if mock mode is enabled\r\n      if ((process.env.REACT_APP_USE_MOCK_API || '').toLowerCase() === 'true') {\r\n        const response = await mockApi.signin({ email: credentials.email, password: credentials.password });\r\n        apiService.setAuthToken(response.accessToken);\r\n        localStorage.setItem('user', JSON.stringify(response.user));\r\n        return response;\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async signup(userData: SignUpRequest): Promise<AuthResponse> {\r\n    const response = await apiService.post<AuthResponse>('/auth/signup', userData);\r\n    \r\n    // Store auth token and user data\r\n    apiService.setAuthToken(response.accessToken);\r\n    localStorage.setItem('user', JSON.stringify(response.user));\r\n    \r\n    return response;\r\n  }\r\n\r\n  async logout(): Promise<void> {\r\n    try {\r\n      await apiService.post('/auth/logout');\r\n    } catch (error) {\r\n      // Even if logout request fails, clear local storage\r\n      console.warn('Logout request failed, but clearing local storage');\r\n    } finally {\r\n      apiService.removeAuthToken();\r\n    }\r\n  }\r\n\r\n  async getCurrentUser(): Promise<User> {\r\n    return await apiService.get<User>('/auth/me');\r\n  }\r\n\r\n  getCurrentUserFromStorage(): User | null {\r\n    const userStr = localStorage.getItem('user');\r\n    if (userStr) {\r\n      try {\r\n        return JSON.parse(userStr);\r\n      } catch (error) {\r\n        console.error('Error parsing user from localStorage:', error);\r\n        localStorage.removeItem('user');\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return apiService.isAuthenticated() && !!this.getCurrentUserFromStorage();\r\n  }\r\n\r\n  clearAuth(): void {\r\n    apiService.removeAuthToken();\r\n  }\r\n}\r\n\r\nexport default new AuthService();"],"mappings":"AAAA,OAAOA,UAAU,MAAM,UAAU;AAEjC,SAASC,OAAO,QAAQ,cAAc;AAEtC,MAAMC,WAAW,CAAC;EAChB,MAAMC,KAAKA,CAACC,WAAyB,EAAyB;IAC5D,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAML,UAAU,CAACM,IAAI,CAAe,cAAc,EAAEF,WAAW,CAAC;MACjF;MACAJ,UAAU,CAACO,YAAY,CAACF,QAAQ,CAACG,WAAW,CAAC;MAC7CC,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEC,IAAI,CAACC,SAAS,CAACP,QAAQ,CAACQ,IAAI,CAAC,CAAC;MAC3D,OAAOR,QAAQ;IACjB,CAAC,CAAC,OAAOS,KAAK,EAAE;MACd;MACA,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,sBAAsB,IAAI,EAAE,EAAEC,WAAW,CAAC,CAAC,KAAK,MAAM,EAAE;QACvE,MAAMb,QAAQ,GAAG,MAAMJ,OAAO,CAACkB,MAAM,CAAC;UAAEC,KAAK,EAAEhB,WAAW,CAACgB,KAAK;UAAEC,QAAQ,EAAEjB,WAAW,CAACiB;QAAS,CAAC,CAAC;QACnGrB,UAAU,CAACO,YAAY,CAACF,QAAQ,CAACG,WAAW,CAAC;QAC7CC,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEC,IAAI,CAACC,SAAS,CAACP,QAAQ,CAACQ,IAAI,CAAC,CAAC;QAC3D,OAAOR,QAAQ;MACjB;MACA,MAAMS,KAAK;IACb;EACF;EAEA,MAAMQ,MAAMA,CAACC,QAAuB,EAAyB;IAC3D,MAAMlB,QAAQ,GAAG,MAAML,UAAU,CAACM,IAAI,CAAe,cAAc,EAAEiB,QAAQ,CAAC;;IAE9E;IACAvB,UAAU,CAACO,YAAY,CAACF,QAAQ,CAACG,WAAW,CAAC;IAC7CC,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEC,IAAI,CAACC,SAAS,CAACP,QAAQ,CAACQ,IAAI,CAAC,CAAC;IAE3D,OAAOR,QAAQ;EACjB;EAEA,MAAMmB,MAAMA,CAAA,EAAkB;IAC5B,IAAI;MACF,MAAMxB,UAAU,CAACM,IAAI,CAAC,cAAc,CAAC;IACvC,CAAC,CAAC,OAAOQ,KAAK,EAAE;MACd;MACAW,OAAO,CAACC,IAAI,CAAC,mDAAmD,CAAC;IACnE,CAAC,SAAS;MACR1B,UAAU,CAAC2B,eAAe,CAAC,CAAC;IAC9B;EACF;EAEA,MAAMC,cAAcA,CAAA,EAAkB;IACpC,OAAO,MAAM5B,UAAU,CAAC6B,GAAG,CAAO,UAAU,CAAC;EAC/C;EAEAC,yBAAyBA,CAAA,EAAgB;IACvC,MAAMC,OAAO,GAAGtB,YAAY,CAACuB,OAAO,CAAC,MAAM,CAAC;IAC5C,IAAID,OAAO,EAAE;MACX,IAAI;QACF,OAAOpB,IAAI,CAACsB,KAAK,CAACF,OAAO,CAAC;MAC5B,CAAC,CAAC,OAAOjB,KAAK,EAAE;QACdW,OAAO,CAACX,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;QAC7DL,YAAY,CAACyB,UAAU,CAAC,MAAM,CAAC;MACjC;IACF;IACA,OAAO,IAAI;EACb;EAEAC,eAAeA,CAAA,EAAY;IACzB,OAAOnC,UAAU,CAACmC,eAAe,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAACL,yBAAyB,CAAC,CAAC;EAC3E;EAEAM,SAASA,CAAA,EAAS;IAChBpC,UAAU,CAAC2B,eAAe,CAAC,CAAC;EAC9B;AACF;AAEA,eAAe,IAAIzB,WAAW,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}